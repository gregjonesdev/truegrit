{% extends '_timekeeperbase.html' %}

{% block timekeeper_content %}
<div class="row">
<div class="col-2">
    <div class="container mt-2" >
        <div class="dropdown dropdown-component" style="text-align: center">
            <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                {{ target_date }}
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dateDropdown">
                <!-- Dates will be populated here -->
            </ul>
        </div>
    </div>
</div>
<div class="col-9">
    <div style="display: flex; flex-direction: row">
        {% if projects|length > 0 %}
            {% for each in projects %}
            <div class="card" style="width: 18rem; margin:5px">
            <div class="card-body">
                <h5 class="card-title">{{ each.project.get_title }}</h5>
        
                <div class="card-text">
                    <table class="table table-sm">
                        <thead>
                        <tr>
                            <th scope="col">Start</th>
                            <th scope="col">End</th>
                            <th scope="col">Hours</th>
                        </tr>
                        </thead>
                        <tbody>
                            {% for entry in each.time_entries %}
                                <tr>
                                    <td>{{ entry.start_time|date:"H:i"  }}</td>
                                    <td>{{ entry.end_time|date:"H:i" }}</td>
                                    <td>{{ entry.get_duration }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    </div>
                <a href="#" class="btn btn-primary">Go somewhere</a>
            </div>
            </div>    
        {% endfor %}
        {% else %}
        <div class="mt-2" style="padding-top: 6px;"><h5>No time entries today</h5></div>
        {% endif %}
    </div>
</div>
</div>
<div>

<script>
    function formatDateForUrl(date) {
    var year = date.getFullYear();
    var month = (date.getMonth() + 1).toString().padStart(2, '0'); // Month is zero-indexed
    var day = date.getDate().toString().padStart(2, '0'); // Pad the day with leading zero if needed
    return `${year}-${month}-${day}`;
}

// Function to format the date into "Thursday, 12/18" for display
function formatDateForDisplay(date) {
    var options = { weekday: 'long', month: '2-digit', day: '2-digit' };
    return date.toLocaleDateString('en-US', options); // This formats the date like "Thursday, 12/18"
}

function getLastFiveDays() {
    let days = [];
    let today = new Date();
    
    for (let i = 0; i < 6; i++) {
        let date = new Date(today);
        date.setDate(today.getDate() - i);
        days.push(date);
    }
    return days;
}

// Access the container where you want to append the list items
let dateDropdown = document.getElementById('dateDropdown');

// Iterate over the lastFiveDays array
lastFiveDays = getLastFiveDays()

lastFiveDays.forEach(function(day) {
    // Get the formatted date for the URL (YYYY-MM-DD)
    let formattedDateForUrl = formatDateForUrl(day);
    
    // Get the formatted date for display (Thursday, 12/18)
    let formattedDateForDisplay = formatDateForDisplay(day);
    
    // Create a new list item for each date
    let listItem = document.createElement('li');
    
    // Insert the link with the dynamically generated date for URL and display
    listItem.innerHTML = `<a class="dropdown-item" href="{% url 'dailytime' %}?date=${formattedDateForUrl}">${formattedDateForDisplay}</a>`;
    
    // Append the list item to the dropdown menu
 
    if ((formattedDateForDisplay != "{{ target_date }}") && (dateDropdown.children.length < 5)) {
        dateDropdown.appendChild(listItem);
    }
    
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

</body>
{% endblock timekeeper_content %}